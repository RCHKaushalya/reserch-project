<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <title>‡∂≠‡∑Ñ‡∑Ä‡∑î‡∂ª‡∑î ‡∂ö‡∑Ö ‡∂ª‡∑ê‡∂ö‡∑í‡∂∫‡∑è</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h2>üìã ‡∂≠‡∑Ñ‡∑Ä‡∑î‡∂ª‡∑î ‡∂ö‡∑Ö ‡∂ª‡∑ê‡∂ö‡∑í‡∂∫‡∑è</h2>
  <form id="userForm">
    <label>‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö ID:</label>
    <input type="number" id="userId" placeholder="e.g. 1" required />
    <button type="submit">‡∂ª‡∑ê‡∂ö‡∑í‡∂∫‡∑è ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±</button>
  </form>

  <div id="jobs"></div>

  <script>
    document.getElementById('userForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const userId = document.getElementById('userId').value;
      const res = await fetch(`/api/confirmed-jobs/${userId}`);
      const jobs = await res.json();

      const container = document.getElementById('jobs');
      container.innerHTML = '';

      if (jobs.length === 0) {
        container.innerHTML = '<p>‡∂≠‡∑Ñ‡∑Ä‡∑î‡∂ª‡∑î ‡∂ö‡∑Ö ‡∂ª‡∑ê‡∂ö‡∑í‡∂∫‡∑è ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠</p>';
        return;
      }

      jobs.forEach(job => {
        const div = document.createElement('div');
        div.innerHTML = `
          <p>üõ†Ô∏è ‡∑É‡∑ö‡∑Ä‡∑è‡∑Ä: ${job.category}</p>
          <p>üë∑ ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∑è: ${job.worker_name}</p>
          <p>üìû ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂±: ${job.worker_phone}</p>
          <label>‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª‡∂∫:</label>
          <input type="text" id="feedback_${job.id}" placeholder="‡∑Ñ‡∑ú‡∂≥ ‡∑É‡∑ö‡∑Ä‡∑è‡∑Ä‡∂ö‡∑ä!" />
          <button onclick="submitFeedback(${job.id})">‡∂∫‡∑Ä‡∂±‡∑ä‡∂±</button>
          <hr/>
        `;
        container.appendChild(div);
      });
    });

    async function submitFeedback(jobId) {
      const feedback = document.getElementById(`feedback_${jobId}`).value;
      await fetch('/api/submit-feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ job_id: jobId, feedback })
      });
      alert('‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª‡∂∫ ‡∂∫‡∑Ä‡∑è ‡∂á‡∂≠!');
    }
  </script>
</body>
</html>
