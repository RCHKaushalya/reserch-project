<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <title>‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h2>üë∑ ‡∑É‡∑ö‡∑Ä‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª</h2>
  <form id="jobForm">
    <label>‡∂ª‡∑ê‡∂ö‡∑í‡∂∫‡∑è ID:</label>
    <input type="number" id="jobId" placeholder="e.g. 12" required />
    <button type="submit">‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂±</button>
  </form>

  <div id="responses"></div>

  <script>
    document.getElementById('jobForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const jobId = document.getElementById('jobId').value;
      const res = await fetch(`/api/job-responses/${jobId}`);
      const data = await res.json();

      const container = document.getElementById('responses');
      container.innerHTML = '';

      if (data.length === 0) {
        container.innerHTML = '<p>‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠</p>';
        return;
      }

      data.forEach(worker => {
        const div = document.createElement('div');
        div.innerHTML = `
          <p>üë§ ‡∂±‡∂∏: ${worker.name}</p>
          <p>üìç ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫: ${worker.location}</p>
          <p>üìû ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂±: ${worker.phone}</p>
          <button onclick="confirmWorker(${worker.id}, ${jobId})">‡∂≠‡∑Ñ‡∑Ä‡∑î‡∂ª‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
          <hr/>
        `;
        container.appendChild(div);
      });
    });

    async function confirmWorker(workerId, jobId) {
      await fetch('/api/confirm-worker', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ worker_id: workerId, job_id: jobId })
      });
      alert('‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∑è ‡∂≠‡∑Ñ‡∑Ä‡∑î‡∂ª‡∑î ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑ì!');
    }
  </script>
</body>
</html>
